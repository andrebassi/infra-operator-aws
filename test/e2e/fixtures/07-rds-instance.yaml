apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: rdsinstances.aws-infra-operator.runner.codes
spec:
  group: aws-infra-operator.runner.codes
  names:
    kind: RDSInstance
    listKind: RDSInstanceList
    plural: rdsinstances
    shortNames:
    - rds
    singular: rdsinstance
  scope: Namespaced
  versions:
  - name: v1alpha1
    served: true
    storage: true
    subresources:
      status: {}
    schema:
      openAPIV3Schema:
        type: object
        properties:
          spec:
            type: object
            required:
            - providerRef
            - dbInstanceIdentifier
            - engine
            - dbInstanceClass
            - allocatedStorage
            - masterUsername
            properties:
              providerRef:
                type: object
                required:
                - name
                properties:
                  name:
                    type: string
                  namespace:
                    type: string
              dbInstanceIdentifier:
                type: string
              engine:
                type: string
              engineVersion:
                type: string
              dbInstanceClass:
                type: string
              allocatedStorage:
                type: integer
                format: int32
                minimum: 20
              masterUsername:
                type: string
              masterUserPasswordSecretRef:
                type: object
                required:
                - name
                - key
                properties:
                  name:
                    type: string
                  key:
                    type: string
              masterUserPassword:
                type: string
              dbName:
                type: string
              port:
                type: integer
                format: int32
              multiAZ:
                type: boolean
              publiclyAccessible:
                type: boolean
              storageEncrypted:
                type: boolean
              backupRetentionPeriod:
                type: integer
                format: int32
                minimum: 0
                maximum: 35
              preferredBackupWindow:
                type: string
              tags:
                type: object
                additionalProperties:
                  type: string
              deletionPolicy:
                type: string
                enum:
                - Delete
                - Retain
              skipFinalSnapshot:
                type: boolean
          status:
            type: object
            properties:
              ready:
                type: boolean
              dbInstanceArn:
                type: string
              endpoint:
                type: string
              port:
                type: integer
                format: int32
              status:
                type: string
              engineVersion:
                type: string
              allocatedStorage:
                type: integer
                format: int32
              lastSyncTime:
                type: string
                format: date-time
              conditions:
                type: array
                items:
                  type: object
                  required:
                  - type
                  - status
                  properties:
                    type:
                      type: string
                    status:
                      type: string
                    observedGeneration:
                      type: integer
                      format: int64
                    lastTransitionTime:
                      type: string
                      format: date-time
                    reason:
                      type: string
                    message:
                      type: string
    additionalPrinterColumns:
    - name: Instance
      type: string
      jsonPath: .spec.dbInstanceIdentifier
    - name: Engine
      type: string
      jsonPath: .spec.engine
    - name: Class
      type: string
      jsonPath: .spec.dbInstanceClass
    - name: Status
      type: string
      jsonPath: .status.status
    - name: Ready
      type: boolean
      jsonPath: .status.ready
    - name: Age
      type: date
      jsonPath: .metadata.creationTimestamp
---
apiVersion: aws-infra-operator.runner.codes/v1alpha1
kind: RDSInstance
metadata:
  name: e2e-postgres-db
  namespace: default
spec:
  providerRef:
    name: localstack
  dbInstanceIdentifier: e2e-test-postgres
  engine: postgres
  engineVersion: "14.7"
  dbInstanceClass: db.t3.micro
  allocatedStorage: 20
  masterUsername: dbadmin
  masterUserPassword: Test123456!
  dbName: testdb
  port: 5432
  multiAZ: false
  publiclyAccessible: true
  storageEncrypted: true
  backupRetentionPeriod: 7
  preferredBackupWindow: "03:00-04:00"
  tags:
    Environment: test
    ManagedBy: infra-operator
    Database: postgres
  deletionPolicy: Delete
  skipFinalSnapshot: true
---
apiVersion: aws-infra-operator.runner.codes/v1alpha1
kind: RDSInstance
metadata:
  name: e2e-mysql-db
  namespace: default
spec:
  providerRef:
    name: localstack
  dbInstanceIdentifier: e2e-test-mysql
  engine: mysql
  engineVersion: "8.0.33"
  dbInstanceClass: db.t3.small
  allocatedStorage: 30
  masterUsername: admin
  masterUserPassword: MyPassword123!
  dbName: mydb
  port: 3306
  multiAZ: true
  publiclyAccessible: false
  storageEncrypted: true
  backupRetentionPeriod: 14
  tags:
    Environment: test
    ManagedBy: infra-operator
    Database: mysql
  deletionPolicy: Delete
  skipFinalSnapshot: true
