<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 600">
  <defs>
    <style>
      .bg { fill: #0f172a; }
      .user-box { fill: #6366f1; stroke: #818cf8; stroke-width: 2; }
      .k8s-box { fill: #326ce5; stroke: #4a8df8; stroke-width: 2; }
      .operator-box { fill: #10b981; stroke: #34d399; stroke-width: 2; }
      .aws-box { fill: #ff9900; stroke: #ffb84d; stroke-width: 2; }
      .text-title { font-family: 'Segoe UI', Arial, sans-serif; font-size: 11px; font-weight: 600; fill: #fff; }
      .text-label { font-family: 'Segoe UI', Arial, sans-serif; font-size: 10px; fill: #fff; }
      .text-small { font-family: 'Segoe UI', Arial, sans-serif; font-size: 9px; fill: #94a3b8; }
      .arrow { stroke: #60a5fa; stroke-width: 2; fill: none; marker-end: url(#arrow-blue); }
      .arrow-aws { stroke: #ffb84d; stroke-width: 2; fill: none; marker-end: url(#arrow-orange); }
      .step-circle { fill: #3b82f6; stroke: #60a5fa; stroke-width: 2; }
      .step-num { font-family: 'Segoe UI', Arial, sans-serif; font-size: 9px; font-weight: 700; fill: #fff; }
      .sub-step { font-family: 'Segoe UI', Arial, sans-serif; font-size: 8px; fill: #cbd5e1; }
    </style>
    <marker id="arrow-blue" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#60a5fa"/>
    </marker>
    <marker id="arrow-orange" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#ffb84d"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect class="bg" width="1000" height="600" rx="12"/>

  <!-- Title -->
  <text x="500" y="28" text-anchor="middle" style="font-family: 'Segoe UI', Arial; font-size: 16px; font-weight: 700; fill: #f1f5f9;">Creating an S3Bucket - Data Flow</text>

  <!-- Step 1: User applies manifest -->
  <rect class="user-box" x="50" y="60" width="180" height="50" rx="8"/>
  <circle class="step-circle" cx="65" cy="85" r="12"/>
  <text class="step-num" x="65" y="89" text-anchor="middle">1</text>
  <text class="text-title" x="140" y="82" text-anchor="middle">User applies manifest</text>
  <text class="text-small" x="140" y="98" text-anchor="middle">kubectl apply -f s3bucket.yaml</text>

  <!-- Step 2: K8s API Server -->
  <rect class="k8s-box" x="50" y="140" width="180" height="50" rx="8"/>
  <circle class="step-circle" cx="65" cy="165" r="12"/>
  <text class="step-num" x="65" y="169" text-anchor="middle">2</text>
  <text class="text-title" x="140" y="162" text-anchor="middle">Kubernetes API Server</text>
  <text class="text-small" x="140" y="178" text-anchor="middle">Persists the CR</text>

  <!-- Step 3: Controller Runtime -->
  <rect class="operator-box" x="50" y="220" width="180" height="50" rx="8"/>
  <circle class="step-circle" cx="65" cy="245" r="12"/>
  <text class="step-num" x="65" y="249" text-anchor="middle">3</text>
  <text class="text-title" x="140" y="242" text-anchor="middle">Controller Runtime</text>
  <text class="text-small" x="140" y="258" text-anchor="middle">Notifies S3BucketController</text>

  <!-- Step 4: Reconcile called -->
  <rect class="operator-box" x="50" y="300" width="180" height="50" rx="8"/>
  <circle class="step-circle" cx="65" cy="325" r="12"/>
  <text class="step-num" x="65" y="329" text-anchor="middle">4</text>
  <text class="text-title" x="140" y="322" text-anchor="middle">Reconcile() Called</text>
  <text class="text-small" x="140" y="338" text-anchor="middle">S3BucketController</text>

  <!-- Sub-steps box -->
  <rect class="operator-box" x="280" y="300" width="440" height="250" rx="10" style="fill-opacity: 0.3;"/>
  <text class="text-title" x="500" y="320" text-anchor="middle">Reconciliation Sub-steps</text>

  <!-- Step 5: Fetch S3Bucket CR -->
  <rect class="k8s-box" x="300" y="340" width="180" height="40" rx="6"/>
  <circle class="step-circle" cx="315" cy="360" r="10"/>
  <text class="step-num" x="315" y="364" text-anchor="middle">5</text>
  <text class="text-label" x="390" y="358" text-anchor="middle">Fetch S3Bucket CR</text>
  <text class="sub-step" x="390" y="372" text-anchor="middle">Get resource from API</text>

  <!-- Step 6: Fetch AWSProvider -->
  <rect class="k8s-box" x="520" y="340" width="180" height="40" rx="6"/>
  <circle class="step-circle" cx="535" cy="360" r="10"/>
  <text class="step-num" x="535" y="364" text-anchor="middle">6</text>
  <text class="text-label" x="610" y="358" text-anchor="middle">Fetch AWSProvider</text>
  <text class="sub-step" x="610" y="372" text-anchor="middle">Build aws.Config</text>

  <!-- Step 7: Check bucket exists -->
  <rect class="aws-box" x="300" y="400" width="180" height="40" rx="6"/>
  <circle class="step-circle" cx="315" cy="420" r="10"/>
  <text class="step-num" x="315" y="424" text-anchor="middle">7</text>
  <text class="text-label" x="390" y="418" text-anchor="middle">HeadBucket API</text>
  <text class="sub-step" x="390" y="432" text-anchor="middle">Check if exists</text>

  <!-- Step 8: Create bucket -->
  <rect class="aws-box" x="520" y="400" width="180" height="40" rx="6"/>
  <circle class="step-circle" cx="535" cy="420" r="10"/>
  <text class="step-num" x="535" y="424" text-anchor="middle">8</text>
  <text class="text-label" x="610" y="418" text-anchor="middle">CreateBucket API</text>
  <text class="sub-step" x="610" y="432" text-anchor="middle">If doesn't exist</text>

  <!-- Step 9: Configure bucket - multiple APIs -->
  <rect class="aws-box" x="300" y="460" width="400" height="70" rx="6"/>
  <circle class="step-circle" cx="315" cy="480" r="10"/>
  <text class="step-num" x="315" y="484" text-anchor="middle">9</text>
  <text class="text-label" x="500" y="478" text-anchor="middle">Configure Bucket</text>
  <text class="sub-step" x="380" y="495" text-anchor="middle">PutBucketVersioning</text>
  <text class="sub-step" x="540" y="495" text-anchor="middle">PutBucketEncryption</text>
  <text class="sub-step" x="380" y="510" text-anchor="middle">PutBucketLifecycleConfiguration</text>
  <text class="sub-step" x="540" y="510" text-anchor="middle">PutBucketCors</text>
  <text class="sub-step" x="380" y="525" text-anchor="middle">PutPublicAccessBlock</text>
  <text class="sub-step" x="540" y="525" text-anchor="middle">PutBucketTagging</text>

  <!-- Step 10: Update status -->
  <rect class="k8s-box" x="760" y="380" width="180" height="60" rx="8"/>
  <circle class="step-circle" cx="775" cy="410" r="12"/>
  <text class="step-num" x="775" y="414" text-anchor="middle">10</text>
  <text class="text-title" x="850" y="405" text-anchor="middle">Update CR Status</text>
  <text class="text-small" x="850" y="422" text-anchor="middle">Kubernetes API Server</text>
  <text class="text-small" x="850" y="435" text-anchor="middle">ready, arn, region</text>

  <!-- AWS Services column -->
  <rect class="aws-box" x="760" y="60" width="180" height="200" rx="10" style="fill-opacity: 0.3;"/>
  <text class="text-title" x="850" y="85" text-anchor="middle">AWS Services</text>
  <text class="sub-step" x="850" y="110" text-anchor="middle">S3 HeadBucket</text>
  <text class="sub-step" x="850" y="130" text-anchor="middle">S3 CreateBucket</text>
  <text class="sub-step" x="850" y="150" text-anchor="middle">S3 PutBucketVersioning</text>
  <text class="sub-step" x="850" y="170" text-anchor="middle">S3 PutBucketEncryption</text>
  <text class="sub-step" x="850" y="190" text-anchor="middle">S3 PutBucketLifecycle</text>
  <text class="sub-step" x="850" y="210" text-anchor="middle">S3 PutBucketCors</text>
  <text class="sub-step" x="850" y="230" text-anchor="middle">S3 PutPublicAccessBlock</text>
  <text class="sub-step" x="850" y="250" text-anchor="middle">S3 PutBucketTagging</text>

  <!-- Arrows -->
  <path class="arrow" d="M 140 110 L 140 140"/>
  <path class="arrow" d="M 140 190 L 140 220"/>
  <path class="arrow" d="M 140 270 L 140 300"/>
  <path class="arrow" d="M 230 325 L 280 325"/>

  <!-- Sub-step arrows -->
  <path class="arrow" d="M 480 360 L 520 360"/>
  <path class="arrow" d="M 390 380 L 390 400"/>
  <path class="arrow" d="M 480 420 L 520 420"/>
  <path class="arrow" d="M 500 440 L 500 460"/>

  <!-- AWS API arrows -->
  <path class="arrow-aws" d="M 480 420 L 520 420 Q 740 420, 740 200 L 760 200"/>
  <path class="arrow-aws" d="M 700 495 L 850 495 L 850 260"/>

  <!-- Update status arrow -->
  <path class="arrow" d="M 700 530 L 850 530 L 850 440"/>
</svg>
